# AVLæ ‘ (æ ‘ADTè¿è½½ 4/13)

â—ï¸ **ã€NEWã€‘** â—ï¸

- 9-15:  [çº¢é»‘æ ‘ä»å…¥é—¨åˆ°çœ‹å¼€](https://leetcode.cn/circle/discuss/SwgIJV/)

è¿™æ˜¯å°ç™½ yuki æ¨å‡ºçš„ã€Œæ ‘ADTã€ç³»åˆ—æ–‡ç« çš„ç¬¬ 4 ç¯‡ (4/13) ã€‚

***

> $keywords$ :
>
> AVLæ ‘ / å•æ—‹è½¬ä¸åŒæ—‹è½¬ / ç»å¯¹å¹³è¡¡



æœ¬æ–‡ä»‹ç»ä¸€ç§æœ€æ—©æå‡ºçš„è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ â€“â€“ AVLæ ‘ã€‚å®é™…ä¸Šæœ¬æ–‡æ˜¯ä¸ºäº†åç»­è®²è§£å¤šç§ **å¹³è¡¡äºŒå‰æ ‘** çš„å‰ç½®æ–‡ç« ï¼Œæœ€ç»ˆç›®çš„æ˜¯è®²è§£ **ã€Œçº¢é»‘æ ‘ã€** (å·²æ¨å‡ºï¼Œ[çº¢é»‘æ ‘ä»å…¥é—¨åˆ°çœ‹å¼€](https://leetcode.cn/circle/discuss/SwgIJV/))ã€‚

æœ¬æ–‡é‡ç‚¹åœ¨äºå±•ç°å¦‚ä½•è®¾è®¡ä¸€ä¸ªAVLæ ‘ç±»ï¼Œåˆ†æä¸»è¦æ–¹æ³•çš„ä»£ç å®ç°ï¼Œå¹¶ç»™å‡ºè¯¥ç±»çš„å®Œæ•´å®ç°ä»£ç ã€‚è¯»è€…å­¦ä¹ ä¹‹å **å¯ä»¥è‡ªå·±å†™å‡ºä¸€ä¸ªæ–¹æ³•è¾ƒä¸ºå®Œå¤‡çš„AVLæ ‘ç±»** ã€‚

***

yukiçš„å…¶ä»–æ–‡ç« å¦‚ä¸‹ï¼Œæ¬¢è¿é˜…è¯»æŒ‡æ­£ï¼

| æ–‡ç«                                                          | [å‘å¸ƒæ—¶é—´] å­—æ•°/è§ˆ/è—/èµ (~09-23)        |
| ------------------------------------------------------------ | ---------------------------------------- |
| [åå¤§æ’åºä»å…¥é—¨åˆ°å…¥èµ˜](https://leetcode.cn/circle/discuss/eBo9UB/)  ğŸ”¥ğŸ”¥ğŸ”¥ | [20220516]  2.5ä¸‡å­—/58.2kè§ˆ/3.5kè—/865èµ |
| [äºŒåˆ†æŸ¥æ‰¾ä»å…¥é—¨åˆ°å…¥ç¡](https://leetcode.cn/circle/discuss/ooxfo8/) ğŸ”¥ğŸ”¥ğŸ”¥ | [20220509]  2.3ä¸‡å­—/35.9kè§ˆ/2.1kè—/484èµ |
| [å¹¶æŸ¥é›†ä»å…¥é—¨åˆ°å‡ºé—¨](https://leetcode.cn/circle/discuss/qmjuMW/) ğŸ”¥ğŸ”¥ | [20220514]  1.2ä¸‡å­—/15.1kè§ˆ/924è—/279èµ  |
| [å›¾è®ºç®—æ³•ä»å…¥é—¨åˆ°æ”¾ä¸‹](https://leetcode.cn/circle/discuss/FyPTTM/) ğŸ”¥ğŸ”¥ | [20220617]  5.6ä¸‡å­—/17.3kè§ˆ/1.2kè—/341èµ |
| æ ‘ADTç³»åˆ— (é¢„è®¡13ç¯‡)                                         | ç³»åˆ—æ–‡ç« ï¼Œè¿è½½ä¸­                         |
| 3. [äºŒå‰æŸ¥æ‰¾æ ‘](https://leetcode.cn/circle/discuss/wPzlSb/)  | [20220801]  5åƒå­—                        |
| 4. [AVLæ ‘](https://leetcode.cn/circle/discuss/zbwD3p/)       | [20220817]  5åƒå­—                        |
| 5. [splayæ ‘](https://leetcode.cn/circle/discuss/BCK17f/)     | [20220817]  5åƒå­—                        |
| 6. [çº¢é»‘æ ‘ä»å…¥é—¨åˆ°çœ‹å¼€](https://leetcode.cn/circle/discuss/SwgIJV/) ğŸ”¥ğŸ¤¯ğŸ¤¯ğŸ¤¯ | [20220915]  3ä¸‡å­—/3.1kè§ˆ/186è—/52èµ      |
| 10. [æ ‘çŠ¶æ•°ç»„ä»å…¥é—¨åˆ°ä¸‹è½¦](https://leetcode.cn/circle/discuss/qGREiN/) ğŸ”¥ğŸ¤¯ | [20220722]  1.1ä¸‡å­—/3.9kè§ˆ/129è—/49èµ    |
| 11. [çº¿æ®µæ ‘ä»å…¥é—¨åˆ°æ€¥åœ](https://leetcode.cn/circle/discuss/H4aMOn/) ğŸ”¥ğŸ¤¯ | [20220726]  2.5ä¸‡å­—/4.8kè§ˆ/324è—/93èµ    |
| [å›¾è®ºç›¸å…³è¯æ˜ç³»åˆ—](https://leetcode.cn/circle/discuss/GV0JrV/) | ç³»åˆ—æ–‡ç«                                  |
| 1. [Dijkstraæ­£ç¡®æ€§è¯æ˜](https://leetcode.cn/circle/discuss/jJQn7V/) ğŸ¤¯ | [20220531]                               |
| 2. [Primæ­£ç¡®æ€§è¯æ˜](https://leetcode.cn/circle/discuss/VVEc8f/) ğŸ¤¯ | [20220919]                               |
| 3. [Bellman-FordåŠSPFAæ­£ç¡®æ€§è¯æ˜](https://leetcode.cn/circle/discuss/xeEwYl/) | [20220602]                               |
| 4. [Floydæ­£ç¡®æ€§è¯æ˜](https://leetcode.cn/circle/discuss/Nbzix4/) | [20220602]                               |
| 5. [æœ€å¤§æµæœ€å°å‰²å®šç†è¯æ˜](https://leetcode.cn/circle/discuss/tMIy36/) ğŸ¤¯ğŸ¤¯ | [20220719]                               |
| 6. [Edmonds-Karpå¤æ‚åº¦è¯æ˜](https://leetcode.cn/circle/discuss/tN3sZc/) ğŸ¤¯ğŸ¤¯ | [20220515]                               |
| 7. [Dinicå¤æ‚åº¦è¯æ˜](https://leetcode.cn/circle/discuss/T9Xa1R/) ğŸ¤¯ğŸ¤¯ | [20220531]                               |



***

[TOC]

***

### AVLæ ‘

å¯¹äºäºŒå‰æŸ¥æ‰¾æ ‘æ’å…¥/åˆ é™¤/æŸ¥æ‰¾ç­‰æ“ä½œï¼Œä¿æŒ $O(logn)$ å¤æ‚åº¦çš„å‰ææ˜¯ **ä¿æŒæ ‘çš„å¹³è¡¡** ï¼Œå³ä¿æŒæ ‘çš„é«˜åº¦ä¸º $logn$ ã€‚åœ¨å‰è¿° [äºŒå‰æŸ¥æ‰¾æ ‘](https://leetcode.cn/circle/discuss/wPzlSb/) çš„åˆ é™¤æ“ä½œä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯åˆ é™¤ç›®æ ‡ç»“ç‚¹å³å­æ ‘ä¸­çš„æœ€å°ç»“ç‚¹ï¼Œå¯ä»¥é¢„è§å¤šæ¬¡åˆ é™¤æ“ä½œåå°†ä½¿æ ‘å‘ˆç° **å·¦é«˜å³ä½çš„å€¾å‘** ã€‚ä¸€æ—¦æ ‘ä¸å¹³è¡¡ï¼Œæ’å…¥åˆ é™¤æŸ¥æ‰¾ç­‰æ“ä½œå°†æ— æ³•è¾¾åˆ° $O(logn)$ çš„å¤æ‚åº¦ï¼Œäºæ˜¯æˆ‘ä»¬è‡ªç„¶ä¼šæƒ³å¦‚ä½•ä½¿å¾—å¯¹æ ‘è¿›è¡Œæ“ä½œåæ€»èƒ½å¤Ÿä¿æŒå¹³è¡¡ã€‚è‹¥ä¸€æ£µ BST åœ¨æ“ä½œåæ€»èƒ½ä¿æŒå¹³è¡¡ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º **å¹³è¡¡ BST** ã€‚ **AVL æ ‘æ˜¯æœ€æ—©æå‡ºçš„è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘** ã€‚

AVL æ ‘ä»¥ **ã€Œæ—‹è½¬ (rotation)ã€** æ“ä½œä¿è¯ **ä»»æ„ç»“ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡ 1**ï¼Œä½¿å¾—æ ‘çš„æ·±åº¦æ€»ä¿æŒä¸º $O(logn)$ ã€‚ä¸‹å›¾å·¦ä¾§çš„æ ‘æ˜¯ AVL æ ‘ï¼Œå³ä¾§çš„æ ‘åˆ™ä¸æ˜¯ AVL æ ‘ï¼Œåœ¨ç»“ç‚¹ 7 å¤„å¤±è¡¡ã€‚

![image.png](https://pic.leetcode-cn.com/1656841310-TPLbDJ-image.png)

> AVL (Adelson-Velsky and Landis Tree) æ ‘ç”± G.M. Adelson-Velsky å’ŒE.M. Landisäº1962å¹´çš„ [è®ºæ–‡](https://zhjwpku.com/assets/pdf/AED2-10-avl-paper.pdf) ä¸­é¦–æ¬¡ä»‹ç»ã€‚
>
> æ–‡æœ¬å†…å®¹ä¸º Mark Allen Weiss æ‰€è‘— [æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æï¼šJavaè¯­è¨€æè¿°](https://awesome-programming-books.github.io/algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%EF%BC%9AJava%E8%AF%AD%E8%A8%80%E6%8F%8F%E8%BF%B0.pdf) ç›¸å…³ç« èŠ‚çš„æ•´ç†å’Œæ€»ç»“ã€‚ä»£ç äº¦æ¥è‡ªè¯¥ä¹¦ï¼Œç•¥ä½œæ”¹åŠ¨ã€‚

<br />


#### æ—‹è½¬

åœ¨ä¸Šå›¾ AVL æ ‘ä¸­æ’å…¥ 6 æ—¶ï¼Œ 6 å°†ä½œä¸º 7 çš„å·¦å­ç»“ç‚¹è¢«æ’å…¥ï¼Œè¿™å°†ç ´åç»“ç‚¹ 8 çš„å¹³è¡¡ (8çš„å·¦å­æ ‘ä¸å…¶å³å­æ ‘é«˜å·®ä¸º 2)ã€‚AVL æ ‘é€šè¿‡æ—‹è½¬æ“ä½œèƒ½å¤Ÿæ¢å¤å¤±è¡¡ç»“ç‚¹çš„å¹³è¡¡ï¼Œæœ¬èŠ‚è¯¦ç»†è®²è§£æ­¤æ“ä½œçš„ç»†èŠ‚ã€‚



è€ƒè™‘æ’å…¥ä¸€ä¸ªç»“ç‚¹ $x$ åï¼Œå¹³è¡¡è¢«ç ´åçš„ç»“ç‚¹ $y1, y2,â€¦$ åªå¯èƒ½åœ¨ $x$ åˆ°æ ¹ç»“ç‚¹è·¯å¾„ä¸Šï¼Œå› æ­¤ **åªéœ€æ²¿ç€æ­¤è·¯å¾„æ¢å¤å¹³è¡¡å³å¯** ã€‚æ›´è¿›ä¸€æ­¥åœ°ï¼Œä¸éš¾è¯æ˜ï¼Œåªéœ€åœ¨ç¬¬ä¸€ä¸ªå¹³è¡¡è¢«ç ´åçš„ç»“ç‚¹ $y$ ï¼ˆ $x$ åˆ°æ ¹ç»“ç‚¹æ–¹å‘ï¼‰ä¸Šé‡æ–°å¹³è¡¡è¿™æ£µæ ‘ï¼Œå³èƒ½ä¿è¯æ•´æ£µæ ‘æ¢å¤ä¸º AVL æ ‘ã€‚

æ’å…¥æƒ…å†µå¿…ä¸ºå¦‚ä¸‹å››æƒ…å½¢ç§ä¹‹ä¸€ï¼š

```
 æƒ…å½¢1(å·¦-å·¦): æ’å…¥ç‚¹åœ¨ y çš„å·¦å„¿å­çš„å·¦å­æ ‘
 æƒ…å½¢2(å·¦-å³): æ’å…¥ç‚¹åœ¨ y çš„å·¦å„¿å­çš„å³å­æ ‘
 æƒ…å½¢3(å³-å·¦): æ’å…¥ç‚¹åœ¨ y çš„å³å„¿å­çš„å·¦å­æ ‘
 æƒ…å½¢4(å³-å³): æ’å…¥ç‚¹åœ¨ y çš„å³å„¿å­çš„å³å­æ ‘
```

å…¶ä¸­ 1 å’Œ 4ï¼Œ2 å’Œ 3 å…³äº $y$ é•œåƒå¯¹ç§°ï¼Œæ‰€ä»¥å®é™…åªæœ‰ä¸¤ç§æƒ…å†µï¼Œä½†ä»ç¼–ç¨‹è§’åº¦æ¥çœ‹éœ€è¦åˆ†åˆ«å¤„ç†è¿™å››ç§æƒ…å½¢ã€‚å¯¹äºå‘ç”Ÿåœ¨å¤–ä¾§çš„æƒ…å†µ (å·¦-å·¦ï¼Œå³-å³) ï¼Œéœ€è¦é€šè¿‡ **å•æ—‹è½¬** æ¢å¤å¹³è¡¡ï¼Œå¯¹äºå‘ç”Ÿåœ¨å†…ä¾§çš„æƒ…å†µ (å·¦-å³ï¼Œå³-å·¦) ï¼Œéœ€è¦é€šè¿‡ **åŒæ—‹è½¬** æ¢å¤å¹³è¡¡ã€‚

> è®¸å¤šèµ„æ–™å°†æœ¬èŠ‚ä»‹ç»çš„å·¦å•æ—‹ã€å³å•æ—‹ã€å·¦å³åŒæ—‹ã€å³å·¦åŒæ—‹åˆ†åˆ«ç§°ä½œ zag, zig, zag-zig, zig-zag æ“ä½œã€‚zig å’Œ zag åŸæ„å¹¶æ— å·¦å³ä¹‹åˆ†ï¼Œä¸ºäº†é¿å…æ­§ä¹‰ï¼Œæœ¬æ–‡ä¸é‡‡ç”¨è¿™ç§ç§°å‘¼ï¼Œè¯»è€…åªéœ€äº†è§£å³å¯ã€‚åœ¨ã€Œä¼¸å±•æ ‘ã€ä¸€èŠ‚ä¸­è¿˜ä¼šæœ‰ã€Œä¸€å­—å‹ã€çš„å·¦å·¦åŒæ—‹å’Œå³å³åŒæ—‹ï¼Œåˆ†åˆ«è¢«ç§°ä¸º zag-zag å’Œ zig-zig ï¼Œä¹Ÿä»…éœ€äº†è§£å³å¯ã€‚

<br />

##### **å•æ—‹è½¬**

**å³å•æ—‹è½¬ (æƒ…å½¢1)ï¼š** å¦‚ä¸‹å›¾ï¼Œåœ¨ $k2$ çš„å·¦å„¿å­çš„å·¦å­æ ‘ä¸­æ’å…¥ç»“ç‚¹åå¯¼è‡´ $k2$ å¤±å»å¹³è¡¡ ( $k2$ å·¦å­æ ‘æ¯”å³å­æ ‘æ·± 2 å±‚)ã€‚

![image.png](https://pic.leetcode-cn.com/1660706050-mewSNE-image.png)

$Y$ ä¸å¯èƒ½ä¸å½“å‰çš„ $X$ åœ¨åŒä¸€æ°´å¹³ä¸Šï¼Œå¦åˆ™åœ¨æ’å…¥å‰å³å¤±è¡¡ã€‚$Y$ ä¹Ÿä¸å¯èƒ½ä¸ $Z$ åœ¨åŒä¸€æ°´å¹³ä¸Šï¼Œå¦åˆ™æ’å…¥åå…ˆå¤±è¡¡çš„æ˜¯ $k1$ï¼ˆåœ¨æ’å…¥ç»“ç‚¹é€šå¾€æ ¹è·¯ä¸Šç¬¬ä¸€ä¸ªå¤±è¡¡ï¼‰ã€‚



å•æ—‹è½¬æ“ä½œæ–¹æ³•ï¼š

åœ¨å¤±è¡¡ç»“ç‚¹ $k2$ å’Œå…¶å·¦å­ç»“ç‚¹ $k1$ ä¹‹é—´æ—‹è½¬ã€‚å¦‚å›¾ï¼Œæ ¸å¿ƒæ“ä½œä¸º `k2.left = k1.right`ï¼Œ`k1.right = k2` ï¼Œå¯ä»¥å½¢è±¡åœ°æè¿°ä¸ºå°† $k1$ æèµ·ï¼Œå°† $Y$ æŠ–è½åˆ° $k2$ çš„å·¦ä¾§ã€‚æ—‹è½¬æ–¹å‘ä¸ºå³ä¾§ï¼Œå³é¡ºæ—¶é’ˆæ–¹å‘ï¼Œä¸”åªæœ‰ä¸€æ¬¡æ—‹è½¬æ“ä½œï¼Œå› æ­¤ç§°ä¸º **å³å•æ—‹è½¬** ã€‚æ—‹è½¬åä»¥ $k2$ å’Œ $k1$ ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„é«˜åº¦ä¹Ÿéœ€è¦å®æ—¶è°ƒæ•´ï¼ˆ $height$ æ˜¯ $AvlNode$ ç±»çš„å±æ€§ï¼‰ã€‚å¦‚ä¸‹æ˜¯è¯¥å·¦-å·¦å•æ—‹è½¬çš„ä»£ç å®ç°ã€‚

```java
private AvlNode<E> rotateRight(AvlNode<E> k2){ // ä¼ å…¥å¤±è¡¡ç»“ç‚¹
    AvlNode<E> k1 = k2.left;
    k2.left = k1.right;
    k1.right = k2;
    k2.height = Math.max(height(k2.left), height(k2.right)); // è°ƒæ•´k2é«˜åº¦
    k1.height = Math.max(height(k1.left), height(k1.right)); // è°ƒæ•´k1é«˜åº¦
    return k1; // è¿”å›è°ƒæ•´ååŸå¤±è¡¡å¤„ç»“ç‚¹
}
```

 å¦‚å›¾è°ƒæ•´ï¼Œå°† $k1$ ä½œä¸ºè°ƒæ•´åæ ‘çš„æ ¹ç»“ç‚¹ï¼Œ$X$ ä¸Šç§» 1 å±‚ï¼Œ$Y$ æ·±åº¦ä¸å˜ï¼Œ$Z$ ä¸‹ç§» 1 å±‚ï¼Œè°ƒæ•´å $XYZ$ æ·±åº¦ç›¸åŒï¼Œæ ‘é«˜åº¦æ¢å¤ä¸ºæ’å…¥å‰çš„é«˜åº¦ã€‚

<br />

**å·¦å•æ—‹è½¬(æƒ…å½¢4)ï¼š** å¦‚ä¸‹å›¾ï¼Œåœ¨ $k1$ çš„å³å„¿å­çš„å³å­æ ‘ä¸­æ’å…¥ç»“ç‚¹åå¯¼è‡´ $k1$ å¤±å»å¹³è¡¡ ( $k1$ å³å­æ ‘æ¯”å·¦å­æ ‘æ·± 2 å±‚)ã€‚

![image.png](https://pic.leetcode-cn.com/1660706134-YyTUbp-image.png)


æ¢å¤å¹³è¡¡çš„æ—‹è½¬æ“ä½œä¸å·¦-å·¦å•æ—‹è½¬ç±»ä¼¼ï¼Œæ ¸å¿ƒæ“ä½œä¸º `k1.right = k2.left`ï¼Œ`k2.left = k1` ã€‚æ—‹è½¬æ–¹å‘ä¸ºå·¦ä¾§ï¼Œå³é€†æ—¶é’ˆæ–¹å‘ï¼Œä¸”åªæœ‰ä¸€æ¬¡æ—‹è½¬æ“ä½œï¼Œå› æ­¤ç§°ä¸º **å·¦å•æ—‹è½¬** ã€‚ä»¥ä¸‹ç»™å‡ºå³-å³å•æ—‹è½¬çš„ä»£ç å®ç°ã€‚

```java
private AvlNode<E> rotateLeft(AvlNode<E> k1){ // ä¼ å…¥å¤±è¡¡ç»“ç‚¹
    AvlNode<E> k2 = k1.right;
    k1.right = k2.left;
    k2.left = k1;
    // è°ƒæ•´å¹³è¡¡åæ›´æ–°k1ï¼Œk2çš„é«˜åº¦
    k1.height = Math.max(height(k1.left), height(k1.right));
    k2.height = Math.max(height(k2.left), height(k2.right));
    return k2; // è¿”å›è°ƒæ•´ååŸå¤±è¡¡å¤„ç»“ç‚¹
}
```

<br />

##### **åŒæ—‹è½¬**

**å·¦å³åŒæ—‹è½¬(æƒ…å½¢2)ï¼š** å¦‚ä¸‹å›¾å·¦ä¾§çš„æ ‘ï¼Œåœ¨ $k2$ çš„å·¦å„¿å­ $k1$ çš„å³å­æ ‘ä¸­æ’å…¥ç»“ç‚¹åå¯¼è‡´ $k2$ å¤±è¡¡ ( $k2$ çš„å·¦å­æ ‘æ¯”å³å­æ ‘é«˜ 2)ã€‚

å¯¹äºæƒ…å½¢2å’Œæƒ…å½¢3ï¼Œå•æ—‹è½¬æ— æ³•æ¢å¤å¹³è¡¡ã€‚å¦‚ä¸‹å›¾ï¼Œæ‰§è¡Œä¸€æ¬¡å•æ—‹è½¬å $k1$ çš„å³å­æ ‘æ¯”å·¦å­æ ‘é«˜ 2ï¼Œå¹³è¡¡æœªæ¢å¤ã€‚æ¢å¤æ­¤æƒ…å½¢çš„å¹³è¡¡éœ€é‡‡ç”¨ **ã€ŒåŒæ—‹è½¬ã€** æ“ä½œã€‚

![image.png](https://pic.leetcode-cn.com/1660706178-nImvWX-image.png)

åŒæ—‹è½¬æ“ä½œæ–¹æ³•ï¼š

å°†ä¸Šè¿°å·¦-å³å¤±è¡¡æƒ…å½¢ (æƒ…å½¢2) è¡¨ç¤ºä¸ºä¸‹å›¾ã€‚å¯¼è‡´å¤±è¡¡çš„ç»“ç‚¹æ’å…¥ä½ç½®ä¸º $k1$ çš„å³å­æ ‘ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤ºä¸º $k2$ åŠå…¶å·¦å³å­æ ‘çš„ç»“æ„ã€‚

å¦‚å‰è¿°ï¼Œå•æ—‹è½¬å°† $k1$ ä½œä¸ºæ ¹æ— æ•ˆï¼Œå› æ­¤è€ƒè™‘å°† $k2$ ä½œä¸ºæ ¹ï¼Œå°† $k2$ çš„å·¦å­æ ‘ $B$ ä½œä¸º $k1$ çš„å³å­æ ‘ï¼Œ$k2$ çš„å³å­æ ‘ $C$ ä½œ ä¸º$k3$ çš„å·¦å­æ ‘ã€‚ç„¶å $k2$ çš„å·¦å³å„¿å­åˆ†åˆ«æ›´æ–°ä¸º $k1$ ï¼Œ $k3$ ã€‚å¦‚ä¸‹å›¾ï¼Œå¹³è¡¡æ¢å¤ã€‚è¯¥åŒæ—‹è½¬å®é™…ä¸Šå¯ä»¥é€šè¿‡å¯¹ $k1$ æ‰§è¡Œä¸€æ¬¡å³-å³å•æ—‹è½¬ï¼Œå†å¯¹ $k3$ æ‰§è¡Œä¸€æ¬¡å·¦-å·¦å•æ—‹è½¬å®ç°ã€‚å¯ä»¥çœ‹åˆ°ä»£ç å®ç°ååˆ†ç®€æ´ã€‚

![image.png](https://pic.leetcode-cn.com/1660706235-cVYNSC-image.png)


```java
/**
 * å·¦å³åŒæ—‹
 * å› k2çš„å·¦å­ç»“ç‚¹çš„å†…ä¾§å­æ ‘ï¼Œå³k2çš„å·¦å­ç»“ç‚¹çš„å³å­æ ‘å¯¼è‡´k2å¤±è¡¡ã€‚
 * å¯¹k2æ‰§è¡Œä¸€æ¬¡å³å•æ—‹è½¬åä»ç„¶åœ¨k1å¤„(æ–°æ ¹)å¤±è¡¡ï¼Œå› æ­¤è€ƒè™‘å±•å¼€ä¸€å¼€å§‹å¯¼è‡´å¤±è¡¡çš„k1å³å­æ ‘ï¼Œ
 * åšå¦‚ä¸‹è½¬æ¢(æ€»æ˜¯ä»¥ä¸­åºéå†çš„é¡ºåºæ ‡æ³¨ç»“ç‚¹ï¼Œæ³¨æ„k1,k2,k3ä½ç½®å˜åŒ–)ã€‚
 * å› ä¸ºä¸çŸ¥é“æ˜¯Bæˆ–Cä¸­çš„å“ªä¸€æ£µå¯¼è‡´å¤±è¡¡(æ¯”Dæ·±2å±‚)ï¼Œæ‰€ä»¥å°†Bï¼ŒCç”»æˆæ¯”Dæ·±1.5ã€‚
 * ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹ä¸¤æ¬¡å•æ—‹è½¬åå¯æ¢å¤åŸå¤±è¡¡å¤„çš„å¹³è¡¡ã€‚
 * 1. å¯¹k1(k3.left)æ‰§è¡Œå·¦å•æ—‹è½¬ã€‚
 * 2. å¯¹k3æ‰§è¡Œå³å•æ—‹è½¬ã€‚
 *
 *           k2                        k3
 *         /    \                    /     \
 *        k1     /\ã€€  è½¬æ¢ä¸º        k1      /\
 *       /  \   /__\   ====>      /   \    /__\
 *     /\    /\   Z             /\     k2    D
 *    /__\  /  \               /__\   /  \
 *     X   /    \               A   /\    /\
 *        /______\                 /  \  /  \
 *           Y                    /____\/____\ã€€
 *                                  B      C
 *                         k3                                k2
 *                       /     \                         /        \
 *  å¯¹k1æ‰§è¡Œ             k2      /\    å¯¹k3æ‰§è¡Œ           K1          K3
 *  ä¸€æ¬¡å·¦å•æ—‹è½¬         /    \  /__\   ä¸€æ¬¡å³å•æ—‹è½¬      /    \       /  \
 *    =====>         k1      /\  D    ====>          /\    /\     /\   /\
 *                 /   \    /  \                    /__\  /ã€€\   / ã€€\ /__\
 *                /\    /\ /____\                    A   /____\ /____\  D
 *               /__\  /  \  C                             B      C
 *ã€€ã€€ã€€ã€€         A   /____\ã€€
 *                      B
 */
private AvlNode<E> rotateLeftRight(AvlNode<E> k3){ // ä¼ å…¥å¤±è¡¡ç»“ç‚¹
    k3.left = rotateLeft(k3.left);
    return rotateRight(k3);
}
```

<br />

**å³-å·¦åŒæ—‹è½¬(æƒ…å½¢3)ï¼š** å¦‚ä¸‹å›¾å·¦ä¾§çš„æ ‘ï¼Œåœ¨k1çš„å³å„¿å­k3çš„å·¦å­æ ‘ä¸­æ’å…¥ç»“ç‚¹åå¯¼è‡´k1å¤±è¡¡(k1çš„å³å­æ ‘æ¯”å·¦å­æ ‘é«˜2)ã€‚

![image.png](https://pic.leetcode-cn.com/1660706286-OEwZUN-image.png)


æ¢å¤å¹³è¡¡çš„æ—‹è½¬æ“ä½œä¸å·¦å³åŒæ—‹è½¬ç±»ä¼¼ï¼Œä»¥ä¸‹ç»™å‡ºå³å·¦åŒæ—‹è½¬çš„ä»£ç å®ç°ã€‚

```java
private AvlNode<E> rotateRightLeft(AvlNode<E> k1){
    k1.right = rotateRight(k1.right);
    return rotateLeft(k1);
}
```

<br />


#### AVLæ ‘ç±»æ¶æ„

ä»¥ä¸‹æ˜¯AVLæŸ¥æ‰¾æ ‘ç±»AvlTreeçš„æ¶æ„ã€‚

| ç±»æˆå‘˜/æ–¹æ³•                                         | æè¿°                                                         |
| --------------------------------------------------- | ------------------------------------------------------------ |
| `private AvlNode<E> root`                           | å­—æ®µï¼ŒAVLæ ‘çš„æ ¹ç»“ç‚¹                                          |
| `private static final int ALLOWED_IMBALANCE = 1`    | å¸¸é‡å­—æ®µï¼Œç»“ç‚¹çš„å¤±è¡¡åˆ¤å®šå€¼ï¼Œå¤§äºæ­¤å€¼åˆ™å¤±è¡¡                   |
| `public AvlTree()`                                  | æ— å‚æ„é€ å™¨ï¼Œ$root$ åˆå§‹åŒ–ä¸º $null$                           |
| `public void makeEmpty()`                           | æ ‘ç½®ç©º                                                       |
| `public boolean isEmpty()`                          | åˆ¤æ–­æ ‘æ˜¯å¦ä¸ºç©º                                               |
| `public void insert(E e)`                           | æ’å…¥ç»“ç‚¹é©±åŠ¨æ–¹æ³•                                             |
| `public void remove(E e)`                           | åˆ é™¤ç»“ç‚¹é©±åŠ¨æ–¹æ³•                                             |
| `public E findMin()`                                | æŸ¥æ‰¾æœ€å°ç»“ç‚¹é©±åŠ¨æ–¹æ³•                                         |
| `public E findMax()`                                | æŸ¥æ‰¾æœ€å¤§ç»“ç‚¹é©±åŠ¨æ–¹æ³•                                         |
| `public boolean contains(E e)`                      | åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ é©±åŠ¨æ–¹æ³•                                 |
| `public void printTree()`                           | æŒ‰ä¸­åºéå†æ‰“å°æ ‘çš„é©±åŠ¨æ–¹æ³•                                   |
| `public int size()`                                 | æ±‚æ ‘çš„ç»“ç‚¹ä¸ªæ•°é©±åŠ¨æ–¹æ³•                                       |
| `public int height()`                               | æ±‚æ ‘çš„é«˜åº¦é©±åŠ¨æ–¹æ³•                                           |
| `public void checkBalance()`                        | æ ‘å¹³è¡¡æ£€æŸ¥é©±åŠ¨æ–¹æ³•                                           |
| `private AvlNode<E> balance(AvlNode<E> t)`          | è°ƒæ•´ $t$ ç»“ç‚¹å¤„çš„å¹³è¡¡ï¼Œå¹¶è¿”å› $t$ ã€‚<br />å¦‚æœ $t$ å¤±å»å¹³è¡¡ï¼Œæ ¹æ®å…¶å¤±è¡¡çš„æƒ…å†µï¼Œæ‰§è¡Œå¦‚ä¸‹å››ç§æƒ…å½¢ä¹‹ä¸€çš„æ—‹è½¬è°ƒæ•´ã€‚<br />å·¦å¤–æƒ…å½¢ï¼Œå¯¹ $t$ æ‰§è¡Œå³å•æ—‹è½¬ $rotateRight$<br />å·¦å†…æƒ…å½¢ï¼Œå¯¹ $t$ æ‰§è¡Œå·¦å³åŒæ—‹è½¬ $rotateLeftRight$<br />å³å¤–æƒ…å½¢ï¼Œå¯¹ $t$ æ‰§è¡Œå·¦å•æ—‹è½¬ $rotateLeft$<br />å³å†…æƒ…å½¢ï¼Œå¯¹ $t$ æ‰§è¡Œå³å·¦åŒæ—‹è½¬ $rotateRightLeft$ |
| `private AvlNode<E> insert(E e, AvlNode<E> t)`      | æ’å…¥ç»“ç‚¹<br />ä¸ BST çš„ä¸åŒåœ¨äºè¿”å›æ—¶è°ƒç”¨ $balance(t)$ ï¼Œ<br />è°ƒæ•´æ’å…¥ $t$ å $t$ å¤„çš„å¹³è¡¡ï¼Œè¿”å› $t$ ã€‚ |
| `private AvlNode<E> remove(E e, AvlNode<E> t)`      | åˆ é™¤ç»“ç‚¹(æ‡’æƒ°åˆ é™¤)<br />ä¸ BST çš„ä¸åŒåœ¨äºè¿”å›æ—¶è°ƒç”¨ $balance(t)$ ï¼Œ<br />è°ƒæ•´åˆ é™¤ $t$ å $t$ å¤„çš„å¹³è¡¡ï¼Œè¿”å› $t$ (æ–° $t$ )ã€‚ |
| `private AvlNode<E> findMin(AvlNode<E> t)`          | è¿”å›æ ‘çš„æœ€å°ç»“ç‚¹                                             |
| `private AvlNode<E> findMax(AvlNode<E> t)`          | è¿”å›æ ‘çš„æœ€å¤§ç»“ç‚¹                                             |
| `private boolean contains(E e, AvlNode<E> t)`       | åˆ¤æ–­æ ‘ä¸­æ˜¯å¦æœ‰æŒ‡å®šå…ƒç´ çš„ç»“ç‚¹                                 |
| `private void printTree(AvlNode<E> t)`              | ä¸­åºéå†æ‰“å°æ ‘                                               |
| `private int height(AvlNode<E> t)`                  | è¿”å›ä»¥ $t$ ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„é«˜åº¦                                |
| `private int size(AvlNode<E> t)`                    | é€’å½’åœ°éå†æ‰€æœ‰ç»“ç‚¹ï¼Œè¿”å›ç»“ç‚¹æ€»æ•°                             |
| `private int checkBalance(AvlNode<E> t)`            | æ£€æŸ¥æ ‘æ˜¯å¦å¹³è¡¡ï¼Œä¸å¹³è¡¡æ‰“å°â€œimbalanceâ€ï¼Œå¹¶è¿”å›æ ‘é«˜åº¦          |
| `private AvlNode<E> rotateRight(AvlNode<E> k2)`     | å³å•æ—‹è½¬                                                     |
| `private AvlNode<E> rotateLeft(AvlNode<E> k1)`      | å·¦å•æ—‹è½¬                                                     |
| `private AvlNode<E> rotateLeftRight(AvlNode<E> k3)` | å·¦å³åŒæ—‹è½¬                                                   |
| `private AvlNode<E> rotateRightLeft(AvlNode<E> k1)` | å³å·¦åŒæ—‹è½¬                                                   |

ä»¥ä¸‹ä¸º AVL æ ‘ç»“ç‚¹åµŒå¥—ç±» $AvlNode$ çš„æ¶æ„ã€‚

| ç±»æˆå‘˜/æ–¹æ³•                                                  | æè¿°                   |
| ------------------------------------------------------------ | ---------------------- |
| `public E element`                                           | å­—æ®µï¼Œæœ¬ç»“ç‚¹å…ƒç´        |
| `public AvlNode<E> left`                                     | å­—æ®µï¼Œæœ¬ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ |
| `public AvlNode<E> right`                                    | å­—æ®µï¼Œæœ¬ç»“ç‚¹çš„å³å­ç»“ç‚¹ |
| `public int height`                                          | å­—æ®µï¼Œè¯¥ç»“ç‚¹çš„é«˜åº¦     |
| `public AvlNode(E theElement)`                               | æ„é€ å™¨                 |
| `public AvlNode(E element, AvlNode<E> left, AvlNode<E> right)` | æ„é€ å™¨                 |

<br />

#### ä¸»è¦æ–¹æ³•

##### insert

æ’å…¥ç»“ç‚¹æ“ä½œç”±æ’å…¥é©±åŠ¨æ–¹æ³•å’Œå…·ä½“æ’å…¥æ–¹æ³•å®Œæˆï¼Œä¸ BST çš„æ’å…¥æ–¹æ³•çš„ä¸åŒåœ¨äºï¼Œæ’å…¥åé€šè¿‡ $balance$ æ–¹æ³•ï¼Œè°ƒæ•´ $t$ å¤„çš„å¹³è¡¡åé€šè¿‡è¿”å›åŸæ ¹ã€‚ç”±äºé€’å½’ï¼Œ$balance$ æ–¹æ³•èƒ½å¤Ÿè‡ªåº•å‘ä¸Šè°ƒæ•´ **æ’å…¥è·¯å¾„ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å¹³è¡¡** ï¼Œä¸”å®é™…ä¸Šåœ¨è°ƒæ•´ **ç¬¬ä¸€ä¸ª**ï¼ˆè‡ªåº•å‘ä¸Šæ–¹å‘ä¸Šçš„ç¬¬ä¸€ä¸ªï¼‰å¤±è¡¡ç»“ç‚¹åä½¿æ•´æ£µæ ‘æ¢å¤ä¸º AVL æ ‘ã€‚$balance$ æ–¹æ³•åç»­è¯¦è¿°ã€‚

```java
public void insert(E e) { // æ’å…¥ç»“ç‚¹é©±åŠ¨æ–¹æ³•
    root = insert(e, root);
}
private AvlNode<E> insert(E e, AvlNode<E> t){ // æ’å…¥ç»“ç‚¹ï¼Œè¿”å›æ—¶æ²¿è·¯æ£€æŸ¥å¹³è¡¡å¹¶è°ƒæ•´
    if(t == null) return new AvlNode<>(e,null, null);
    int compareRes = e.compareTo(t.element);
    if(compareRes < 0) t.left = insert(e, t.left);
    else if(compareRes > 0) t.right = insert(e, t.right);
    // ç­‰äºæ—¶ä¸æ’å…¥(ä»¥è¯¥æ ‘åªèƒ½å­˜æ”¾ä¸åŒçš„å…ƒç´ ä¸ºå‰æ)
    return balance(t); // è°ƒæ•´tå¤„çš„å¹³è¡¡å¹¶è¿”å›t
}
```

<br />

##### findMin/findMax

ä¸ BST çš„å¯¹åº”æ–¹æ³•ä¸€è‡´ã€‚

```java
public E findMin() { // æŸ¥æ‰¾æœ€å°ç»“ç‚¹é©±åŠ¨æ–¹æ³•
    if(isEmpty()) throw new NoSuchElementException();
    return findMin(root).element;
}
private AvlNode<E> findMin(AvlNode<E> t){ // è¿”å›æ ‘çš„æœ€å°ç»“ç‚¹(é€’å½’æ–¹å¼)
    if(t == null) return null;
    else if(t.left == null) return t;
    return findMin(t.left);
}
public E findMax(){ // æŸ¥æ‰¾æœ€å¤§ç»“ç‚¹é©±åŠ¨æ–¹æ³•
    if(isEmpty()) throw new NoSuchElementException();
    return findMax(root).element;
}
private AvlNode<E> findMax(AvlNode<E> t){ // è¿”å›æ ‘çš„æœ€å¤§ç»“ç‚¹(å¾ªç¯æ–¹å¼)
    if(t == null) return null;
    while(t.right != null) t = t.right;
    return t;
}
```

<br />

##### remove

åˆ é™¤ç»“ç‚¹æ“ä½œç”±åˆ é™¤é©±åŠ¨æ–¹æ³•å’Œå…·ä½“åˆ é™¤æ–¹æ³•å®Œæˆï¼Œä¸ BST çš„åˆ é™¤æ–¹æ³•çš„ä¸åŒåœ¨äºï¼Œåˆ é™¤åé€šè¿‡ $balance$ æ–¹æ³•ï¼Œè°ƒæ•´ $t$ å¤„çš„å¹³è¡¡åé€šè¿‡è¿”å›åŸæ ¹ã€‚ç”±äºé€’å½’ï¼Œ$balance$ æ–¹æ³•èƒ½å¤Ÿè‡ªåº•å‘ä¸Šè°ƒæ•´ **æ’å…¥è·¯å¾„ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å¹³è¡¡** ï¼Œä¸”å®é™…ä¸Šåœ¨è°ƒæ•´ **ç¬¬ä¸€ä¸ª**ï¼ˆè‡ªåº•å‘ä¸Šæ–¹å‘ä¸Šçš„ç¬¬ä¸€ä¸ªï¼‰å¤±è¡¡ç»“ç‚¹åä½¿æ•´æ£µæ ‘æ¢å¤ä¸º AVL æ ‘ã€‚$balance$ æ–¹æ³•åç»­è¯¦è¿°ã€‚

```java
public void remove(E e) { // åˆ é™¤ç»“ç‚¹é©±åŠ¨æ–¹æ³•
    root = remove(e, root);
}
private AvlNode<E> remove(E e, AvlNode<E> t){ // åˆ é™¤ç»“ç‚¹(æ‡’æƒ°åˆ é™¤)ï¼Œè¿”å›æ—¶æ²¿è·¯æ£€æŸ¥å¹³è¡¡å¹¶è°ƒæ•´
    if(t == null) return null;
    int compareRes = e.compareTo(t.element);
    if(compareRes < 0) t.left = remove(e, t.left); // é€’å½’åœ°åœ¨å·¦ä¾§å¯»æ‰¾
    else if(compareRes > 0) t.right = remove(e, t.right); // é€’å½’åœ°åœ¨å³ä¾§å¯»æ‰¾
    // eç­‰äºt.elementï¼Œåˆ†ä¸¤ç§æƒ…å½¢
    else if(t.left != null && t.right != null) { // æƒ…å½¢1ï¼šè¯¥tçš„å·¦å³å­ç»“ç‚¹å‡ä¸ä¸ºnull
        t.element = findMin(t.right).element; // åœ¨å³å­æ ‘ä¸­æ‰¾min
        t.right = remove(t.element, t.right); // æ­¤æ—¶minå·²æ˜¯t.elementï¼Œå¿…ä¸ºæƒ…å½¢2
    }
    else t = (t.left != null) ? t.left : t.right; // æƒ…å½¢2: 1ä»¥å¤–çš„æƒ…å½¢
    return balance(t); // è°ƒæ•´tå¤„çš„å¹³è¡¡å¹¶è¿”å›t
}
```

<br />

##### contains

ä¸ BST çš„å¯¹åº”æ–¹æ³•ä¸€è‡´ã€‚

```java
public boolean contains(E e) { // åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ é©±åŠ¨æ–¹æ³•
    return contains(e, root);
}
private boolean contains(E e, AvlNode<E> t) {
    if(t == null) return false;
    int compareRes = e.compareTo(t.element);
    if(compareRes < 0) return contains(e, t.left);
    else if(compareRes > 0) return contains(e, t.right);
    else return true;
}
```

<br />

##### balance

åœ¨æ¯ä¸€æ¬¡æ’å…¥æˆ–åˆ é™¤ç»“ç‚¹åï¼Œè·¯å¾„ä¸Šç»“ç‚¹ $t$ çš„å¹³è¡¡ã€‚åˆ¤æ–­ $t$ çš„å·¦å³å­æ ‘é«˜å·®æ˜¯å¦è¶…è¿‡è®¾å®šçš„å€¼ï¼ˆ`ALLOWED_IMBALANCE = 1`ï¼‰ï¼Œè‹¥è¶…è¿‡åˆ™åˆ†åˆ«åˆ¤æ–­å±äºå·¦-å·¦ã€å·¦-å³ã€å³-å³ã€å³-å·¦ä¸­çš„å“ªä¸€ç§æƒ…å½¢ï¼Œè°ƒç”¨ç›¸åº”çš„æ—‹è½¬æ–¹æ³•è°ƒæ•´å³å¯ã€‚è¯¥æ–¹æ³•è¿”å› $t$ ã€‚

```java
private AvlNode<E> balance(AvlNode<E> t){ // è°ƒæ•´ t ç»“ç‚¹å¤„çš„å¹³è¡¡ï¼Œå¹¶è¿”å› t
    if(t == null) return null;
    if(height(t.left) - height(t.right) > ALLOWED_IMBALANCE) { // å¤±è¡¡ï¼Œä¸”å·¦é«˜äºå³
        if(height(t.left.left) >= height(t.left.right)){ // å³å•æ—‹æƒ…å½¢
            t = rotateRight(t);
        }
        else t = rotateLeftRight(t); // å·¦å³åŒæ—‹æƒ…å½¢
    }
    else if(height(t.right) - height(t.left) > ALLOWED_IMBALANCE){ // å¤±è¡¡ï¼Œä¸”å³é«˜äºå·¦
        if(height(t.right.right) >= height(t.right.left)) { // å·¦å•æ—‹æƒ…å½¢
            t = rotateLeft(t);
        }
        else t = rotateRightLeft(t); // å³å·¦åŒæ—‹æƒ…å½¢
    }
    t.height = Math.max(height(t.left), height(t.right)) + 1; // æ›´æ–° t çš„é«˜åº¦
    return t;
}
```

<br />

##### rotateRight

å³å•æ—‹è½¬ï¼Œè§å‰è¿°è¯´æ˜ã€‚

<br />

##### rotateLeft

å·¦å•æ—‹è½¬ï¼Œè§å‰è¿°è¯´æ˜ã€‚

<br />

##### rotateLeftRight

å·¦å³åŒæ—‹è½¬ï¼Œè§å‰è¿°è¯´æ˜ã€‚

<br />

##### rotateRightLeft

å³å·¦åŒæ—‹è½¬ï¼Œè§å‰è¿°è¯´æ˜ã€‚

<br />

##### checkBalance

æ£€æŸ¥æ•´æ£µæ ‘æ˜¯å¦å¹³è¡¡çš„æ–¹æ³•ã€‚ç”±å¹³è¡¡æ£€æŸ¥é©±åŠ¨æ–¹æ³•å’Œå…·ä½“å¹³è¡¡æ£€æŸ¥æ–¹æ³•å®Œæˆã€‚å…·ä½“æ–¹æ³•ä¸­ä»¥é€’å½’æ–¹å¼æ£€æŸ¥ï¼Œè‹¥å¹³è¡¡åˆ™è¿”å›æ ‘é«˜ï¼Œä¸å¹³è¡¡åˆ™æ‰“å° $imbalance$ å¹¶è¿”å›æ ‘é«˜ã€‚

```java
public void checkBalance() { // æ ‘å¹³è¡¡æ£€æŸ¥é©±åŠ¨æ–¹æ³•
    checkBalance(root);
}
private int checkBalance(AvlNode<E> t) { // æ£€æŸ¥æ ‘æ˜¯å¦å¹³è¡¡ï¼Œä¸å¹³è¡¡æ‰“å°â€œimbalanceâ€ï¼Œå¹¶è¿”å›æ ‘é«˜åº¦
    if(t == null) return -1;
    int lh = checkBalance(t.left);
    int rh = checkBalance(t.right);
    if(Math.abs(height(t.left) - height(t.right)) > 1
            || height(t.left) != lh || height(t.right) != rh) {
        System.out.println("imbalance");
    }
    return height(t);
}
```

<br />

#### ç±»çš„å®ç°ä»£ç 

```java
class AvlTree<E extends Comparable<? super E>>{
    private AvlNode<E> root;
    private static final int ALLOWED_IMBALANCE = 1;
    public AvlTree() {} // æ— å‚æ„é€ å™¨
    public void makeEmpty() { // æ ‘ç½®ç©º
        root = null;
    }
    public boolean isEmpty() { // æ ‘åˆ¤ç©º
        return root == null;
    }
    public void insert(E e) { // æ’å…¥ç»“ç‚¹é©±åŠ¨æ–¹æ³•
        root = insert(e, root);
    }
    public void remove(E e) { // åˆ é™¤ç»“ç‚¹é©±åŠ¨æ–¹æ³•
        root = remove(e, root);
    }
    public E findMin() { // æŸ¥æ‰¾æœ€å°ç»“ç‚¹é©±åŠ¨æ–¹æ³•
        if(isEmpty()) throw new NoSuchElementException();
        return findMin(root).element;
    }
    public E findMax(){ // æŸ¥æ‰¾æœ€å¤§ç»“ç‚¹é©±åŠ¨æ–¹æ³•
        if(isEmpty()) throw new NoSuchElementException();
        return findMax(root).element;
    }
    public boolean contains(E e) { // åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ é©±åŠ¨æ–¹æ³•
        return contains(e, root);
    }
    public void printTree(){ // æŒ‰ä¸­åºéå†æ‰“å°æ ‘çš„é©±åŠ¨æ–¹æ³•
        if(isEmpty()) System.out.println("Empty tree");
        else printTree(root);
    }
    public int size() { // æ±‚æ ‘çš„ç»“ç‚¹ä¸ªæ•°é©±åŠ¨æ–¹æ³•
        return size(root);
    }
    public int height() { // æ±‚æ ‘çš„é«˜åº¦é©±åŠ¨æ–¹æ³•
        return height(root);
    }
    public void checkBalance() { // æ ‘å¹³è¡¡æ£€æŸ¥é©±åŠ¨æ–¹æ³•
        checkBalance(root);
    }
    private AvlNode<E> balance(AvlNode<E> t){ // è°ƒæ•´ t ç»“ç‚¹å¤„çš„å¹³è¡¡ï¼Œå¹¶è¿”å› t
        if(t == null) return null;
        if(height(t.left) - height(t.right) > ALLOWED_IMBALANCE) { // å¤±è¡¡ï¼Œä¸”å·¦é«˜äºå³
            if(height(t.left.left) >= height(t.left.right)){ // å³å•æ—‹æƒ…å½¢
                t = rotateRight(t);
            }
            else t = rotateLeftRight(t); // å·¦å³åŒæ—‹æƒ…å½¢
        }
        else if(height(t.right) - height(t.left) > ALLOWED_IMBALANCE){ // å¤±è¡¡ï¼Œä¸”å³é«˜äºå·¦
            if(height(t.right.right) >= height(t.right.left)) { // å·¦å•æ—‹æƒ…å½¢
                t = rotateLeft(t);
            }
            else t = rotateRightLeft(t); // å³å·¦åŒæ—‹æƒ…å½¢
        }
        t.height = Math.max(height(t.left), height(t.right)) + 1; // æ›´æ–° t çš„é«˜åº¦
        return t;
    }
    private AvlNode<E> insert(E e, AvlNode<E> t){ // æ’å…¥ç»“ç‚¹ï¼Œè¿”å›æ—¶æ²¿è·¯æ£€æŸ¥å¹³è¡¡å¹¶è°ƒæ•´
        if(t == null) return new AvlNode<>(e,null, null);
        int compareRes = e.compareTo(t.element);
        if(compareRes < 0) t.left = insert(e, t.left);
        else if(compareRes > 0) t.right = insert(e, t.right);
        // ç­‰äºæ—¶ä¸æ’å…¥(ä»¥è¯¥æ ‘åªèƒ½å­˜æ”¾ä¸åŒçš„å…ƒç´ ä¸ºå‰æ)
        return balance(t); // è°ƒæ•´tå¤„çš„å¹³è¡¡å¹¶è¿”å›t
    }
    private AvlNode<E> remove(E e, AvlNode<E> t){ // åˆ é™¤ç»“ç‚¹(æ‡’æƒ°åˆ é™¤)ï¼Œè¿”å›æ—¶æ²¿è·¯æ£€æŸ¥å¹³è¡¡å¹¶è°ƒæ•´
        if(t == null) return null;
        int compareRes = e.compareTo(t.element);
        if(compareRes < 0) t.left = remove(e, t.left); // é€’å½’åœ°åœ¨å·¦ä¾§å¯»æ‰¾
        else if(compareRes > 0) t.right = remove(e, t.right); // é€’å½’åœ°åœ¨å³ä¾§å¯»æ‰¾
        // eç­‰äºt.elementï¼Œåˆ†ä¸¤ç§æƒ…å½¢
        else if(t.left != null && t.right != null) { // æƒ…å½¢1ï¼šè¯¥tçš„å·¦å³å­ç»“ç‚¹å‡ä¸ä¸ºnull
            t.element = findMin(t.right).element; // åœ¨å³å­æ ‘ä¸­æ‰¾min
            t.right = remove(t.element, t.right); // æ­¤æ—¶minå·²æ˜¯t.elementï¼Œå¿…ä¸ºæƒ…å½¢2
        }
        else t = (t.left != null) ? t.left : t.right; // æƒ…å½¢2: 1ä»¥å¤–çš„æƒ…å½¢
        return balance(t); // è°ƒæ•´tå¤„çš„å¹³è¡¡å¹¶è¿”å›t
    }
    private AvlNode<E> findMin(AvlNode<E> t){ // è¿”å›æ ‘çš„æœ€å°ç»“ç‚¹(é€’å½’æ–¹å¼)
        if(t == null) return null;
        else if(t.left == null) return t;
        return findMin(t.left);
    }
    private AvlNode<E> findMax(AvlNode<E> t){ // è¿”å›æ ‘çš„æœ€å¤§ç»“ç‚¹(å¾ªç¯æ–¹å¼)
        if(t == null) return null;
        while(t.right != null) t = t.right;
        return t;
    }
    private boolean contains(E e, AvlNode<E> t) { // åˆ¤æ–­æ ‘ä¸­æ˜¯å¦æœ‰æŒ‡å®šå…ƒç´ çš„ç»“ç‚¹
        if(t == null) return false;
        int compareRes = e.compareTo(t.element);
        if(compareRes < 0) return contains(e, t.left);
        else if(compareRes > 0) return contains(e, t.right);
        else return true;
    }
    private void printTree(AvlNode<E> t) { // ä¸­åºéå†æ‰“å°æ ‘
        if(t != null) {
            printTree(t.left);
            System.out.println(t.element);
            printTree(t.right);
        }
    }
    private int height(AvlNode<E> t) { // è¿”å›ä»¥tä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„é«˜åº¦
        return t == null ? -1 : t.height;
    }
    private int size(AvlNode<E> t) { // é€’å½’åœ°éå†æ‰€æœ‰ç»“ç‚¹ï¼Œè¿”å›ç»“ç‚¹æ€»æ•°
        if(t != null) {
            if(t.left != null && t.right != null) {
                return 1 + size(t.left) + size(t.right);
            }
            else {
                return t.left != null ? 1 + size(t.left) : 1 + size(t.right);
            }
        }
        return 0;
    }
    private int checkBalance(AvlNode<E> t) { // æ£€æŸ¥æ ‘æ˜¯å¦å¹³è¡¡ï¼Œä¸å¹³è¡¡æ‰“å°â€œimbalanceâ€ï¼Œå¹¶è¿”å›æ ‘é«˜åº¦
        if(t == null) return -1;
        int lh = checkBalance(t.left);
        int rh = checkBalance(t.right);
        if(Math.abs(height(t.left) - height(t.right)) > 1
                || height(t.left) != lh || height(t.right) != rh) {
            System.out.println("imbalance");
        }
        return height(t);
    }
    private AvlNode<E> rotateRight(AvlNode<E> k2){ // å³å•æ—‹
        AvlNode<E> k1 = k2.left;
        k2.left = k1.right;
        k1.right = k2;
        k2.height = Math.max(height(k2.left), height(k2.right)); // è°ƒæ•´k2é«˜åº¦
        k1.height = Math.max(height(k1.left), height(k1.right)); // è°ƒæ•´k1é«˜åº¦
        return k1; // è¿”å›è°ƒæ•´ååŸå¤±è¡¡å¤„ç»“ç‚¹
    }
    private AvlNode<E> rotateLeft(AvlNode<E> k1){ // å·¦å•æ—‹
        AvlNode<E> k2 = k1.right;
        k1.right = k2.left;
        k2.left = k1;
        k1.height = Math.max(height(k1.left), height(k1.right)); // è°ƒæ•´k1é«˜åº¦
        k2.height = Math.max(height(k2.left), height(k2.right)); // è°ƒæ•´k2é«˜åº¦
        return k2; // è¿”å›è°ƒæ•´ååŸå¤±è¡¡å¤„ç»“ç‚¹
    }
    private AvlNode<E> rotateLeftRight(AvlNode<E> k3){ // å·¦å³åŒæ—‹
        k3.left = rotateLeft(k3.left);
        return rotateRight(k3);
    }
    private AvlNode<E> rotateRightLeft(AvlNode<E> k1){ // å³å·¦åŒæ—‹
        k1.right = rotateRight(k1.right);
        return rotateLeft(k1);
    }
    /**
     * AVLæ ‘ç»“ç‚¹åµŒå¥—ç±»
     */
    private static class AvlNode<E>{
        public E element;
        public AvlNode<E> left, right;
        // æ¯”BinaryNodeå¤šç»´æŠ¤ä¸€ä¸ªheightå­—æ®µï¼Œæ¯æ¬¡insertæˆ–removeä¸€ä¸ªç»“ç‚¹æ—¶é€šè¿‡balanceæ–¹æ³•æ›´æ–°
        public int height;
        @SuppressWarnings("unused")
        public AvlNode(E theElement){
            this(theElement, null, null);
        }
        public AvlNode(E element, AvlNode<E> left, AvlNode<E> right){
            this.element = element;
            this.left = left;
            this.right = right;
            this.height = 0;
        }
    }
}
```

<br />

#### æµ‹è¯•ä»£ç 

```java
package com.yukiyama;

import java.util.NoSuchElementException;

public class AvlTreeDemo {

    public static void main(String[] args) {
        AvlTree<Integer> t = new AvlTree<>( );
        int[] elements = {3,2,1,4,5,6,7,16,15,14,13,12,11,10,8,9};
        for(int e : elements) t.insert(e);
        t.printTree();
        System.out.printf("size: %d, height: %d, min: %d, max: %d\n", t.size(), t.height(), t.findMin(), t.findMax()); // è¾“å‡º10
        System.out.printf("has 10? %s, has 100? %s\n", t.contains(10), t.contains(100));
        t.checkBalance();
        t.remove(1); t.checkBalance();
        t.remove(10); t.checkBalance();
        t.remove(16); t.checkBalance();
        t.printTree(); // 8 10 13 20 29 74 98
        System.out.printf("size: %d, height: %d\n", t.size(), t.height());// è¾“å‡º0
        System.out.println("is empty: " + t.isEmpty()); // false
        t.makeEmpty();
        System.out.println("is empty: " + t.isEmpty()); // true
    }

}
```

<br />